<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>
  <script src="js/sessao.js"></script>
  <link rel="stylesheet" href="styles/dashgeral.css" />
</head>

<body>

  <!-- Inicio estruturação Modal -->
  <div class="overlay-user" id="overlayUser" onclick="esconderModal()">
  </div>
  <div class="user-menu" id="userMenu">
    <div class="titulo-user-menu">
      <img src="assets/dashboard/user.png" height="70px" alt="">
      <span id="modal_nome_empresa"></span>
    </div>

    <div class="info-user-menu">
      <span class="nome-user" id="modal_nome_usuario">Julia Araripe</span>
      <span class="email-user" id="modal_email_usuario">araripe@email.com</span>
    </div>

    <div class="btn-sair-user-menu">
      <a href="login.html" onclick="limparSessao()">Sair</a>
    </div>
  </div>
  <!-- Término estruturação Modal -->

  <!-- Inicio estruturação do corpo da dasboard -->
  <div class="main">
    <div class="title">
      <img src="assets/imagens/footer-img.png" class="logo" />
      <span class="title-main">Monitoramento de Veículos</span>
      <img src="assets/dashboard/user.png" onclick="exibirModal()" class="user" />
    </div>


    <!-- Inicio estruturação das KPIS -->
    <div class="kpis">
      <div class="metrica">
        <span class="texto-kpis" style="font-size: 20px">Ideal:</span>
        <span class="texto-kpis" style="font-size: 30px">2°C - 8°C</span>
      </div>
      <div class="qtd-veiculos">
        <span class="texto-kpis" style="margin-right: 10px">Quantidade de Veículos:</span>
        <span class="texto-kpis">1</span>
      </div>
      <div class="qtd-normal">
        <span class="texto-kpis" style="margin-right: 10px">Normal:</span>
        <span class="texto-kpis">0</span>
      </div>
      <div class="qtd-no-limite">
        <span class="texto-kpis" style="margin-right: 10px">No limite:</span>
        <span class="texto-kpis">0</span>
      </div>
      <div class="qtd-alerta">
        <span class="texto-kpis" style="margin-right: 10px">Em alerta:</span>
        <span class="texto-kpis">1</span>
      </div>
    </div>
    <!-- Término estruturação das KPIS -->

    
    <!-- Inicio estruturação dos cards de informação e gráficos -->
    <div class="informacoes">
      

      <!-- Inicio estruturação do card de histórico de alertas -->
      <div class="historico">
        <div class="imagem_metrica">
          <img src="assets/imagens/kpi metrica.png" alt="">
        </div>
        <div class="titulo-historico">Histórico de Alertas</div>
        <div class="tabela-historico">
          <table>
            <thead>
              <tr class="cabecalho-tabela">
                <th>Data</th>
                <th>Hora</th>
                <th>Veículo</th>
                <th>Temperatura</th>
              </tr>
            </thead>
            <tbody id="tabela-dados">
              <!-- <tr>
                <td>05/10/2025</td>
                <td>21:05</td>
                <td>VWX1234</td>
                <td>-3°C</td>
              </tr>
              <tr>
                <td>data05/10/2025</td>
                <td>hora21:00</td>
                <td>placa</td>
                <td>temp°C</td>
              </tr>  -->
            </tbody>
          </table>
        </div>
      </div>
      <!-- Término estruturação do card de histórico de alertas -->



      <!-- Inicio estruturação do card de monitoramento dos véiculos -->
      <div class="monitoramento" id="monitoramento">
        <div onclick="ir1()" id="veiculo_1" class="card card-alerta">
          <img class="img-caminhao" src="assets/dashboard/caminhao-atencao.png" />

          <div class="id-caminhao">
            <span class="texto-card texto-placa">Placa:</span>
            <span class="texto-card">VWX1234</span>
          </div>

          <div class="temp-caminhao">
            <span class="texto-card texto-placa">Temperatura:</span>
            <span class="texto-card">-3°C</span>
          </div>

          <div class="status-caminhao">
            <img src="assets/dashboard/atencao.png" class="status-atencao">
            <span class="texto-card texto-placa">Status:&nbsp;</span>
            <span class="texto-card">Alerta</span>
          </div>
        </div>

      </div>
      <!-- Término estruturação do card de monitoramento dos véiculos -->


    </div>
    <!-- Término estruturação dos cards de informação -->


  </div>
  <!-- Término estruturação do corpo da dashboard -->
</body>

</html>
<script>
  // Declaração de variaveis
  var listaVeiculos;



  validarSessao()
  obterVeiculos()

  // Inicio configuração Modal
  overlayUser.style.display = 'none';
  userMenu.style.display = 'none';
  exibirNoModal();

  function exibirModal() {
    overlayUser.style.display = 'block';
    userMenu.style.display = 'flex';
  }

  function esconderModal() {
    overlayUser.style.display = 'none';
    userMenu.style.display = 'none';
  }
  // Término configuração Modal


  function exibirNoModal(){
    document.getElementById("modal_nome_empresa").innerHTML = sessionStorage.NOME_EMPRESA
    document.getElementById("modal_nome_usuario").innerHTML = sessionStorage.NOME_USUARIO
    document.getElementById("modal_email_usuario").innerHTML = sessionStorage.EMAIL_USUARIO
  }



  // function montarTabela(){
  //       let tabela = document.getElementById("tabela-dados")

  //       for(let i = 0; i < valor_tabela.length; i++){
  //           let posicao = i+1
  //           let nickname = valor_tabela[i].nickname
  //           let pontuacao = valor_tabela[i].pontuacao * 7;

  //           tabela.innerHTML += `
  //           <tr>
  //               <td>${data}</td>
  //               <td>${hora}</td>
  //               <td>${veiculo}</td>
  //               <td>${temperatura}</td>
  //           </tr>`
  //       }
  // }


function obterVeiculos(){
  var empresa = sessionStorage.ID_EMPRESA;
  fetch(`/veiculo/obterVeiculos/${empresa}`, { cache: "no-store" })
    .then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {
          resposta.reverse();

          listaVeiculos = resposta;

          montarPainelVeiculos();
        });
      } else {
        console.error("Nenhum dado encontrado ou erro na API");
      }
    })
    .catch(function (error) {
      console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
    });
}
    


    function montarPainelVeiculos(){
        let painelVeiculos = document.getElementById("monitoramento")

        for(let i = 0; i < listaVeiculos.length; i++){
            let placa = listaVeiculos[i].placa;
            let temperatura = listaVeiculos[i].temperatura_atual;

            mensagem += `
               <div onclick="ir1()" id="veiculo_1" class="card card-alerta">
                  <img class="img-caminhao" src="assets/dashboard/caminhao-atencao.png" />

                  <div class="id-caminhao">
                    <span class="texto-card texto-placa">Placa:</span>
                    <span class="texto-card">${placa}</span>
                  </div>

                  <div class="temp-caminhao">
                    <span class="texto-card texto-placa">Temperatura:</span>
                    <span class="texto-card">${temperatura}</span>
                  </div>

                  <div class="status-caminhao">
                    <img src="assets/dashboard/atencao.png" class="status-atencao">
                    <span class="texto-card texto-placa">Status:&nbsp;</span>
                    <span class="texto-card">Alerta</span>
                  </div>
                </div>
                `
        }

        painelVeiculos.innerHTML = mensagem;
  }
</script>